<!DOCTYPE html>
<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Predictive Search Dashboard</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0d93f2",
                        "background-light": "#f5f7f8",
                        "background-dark": "#101b22",
                    },
                    fontFamily: {
                        "display": ["Manrope", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  <style>
    @keyframes gx-search-glow {
      0% {
        box-shadow: 0 0 0 0 rgba(13, 147, 242, 0.0);
      }
      50% {
        box-shadow: 0 0 24px 3px rgba(13, 147, 242, 0.40);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(13, 147, 242, 0.0);
      }
    }

    .gx-search-glow {
      animation: gx-search-glow 2.4s ease-in-out infinite;
      border-radius: 1rem;
    }
  </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }

    @keyframes gx-tagline-glow {
      0% {
        text-shadow: 0 0 0 rgba(59, 130, 246, 0.0);
        opacity: 0.8;
      }
      50% {
        text-shadow: 0 0 18px rgba(59, 130, 246, 0.7);
        opacity: 1;
      }
      100% {
        text-shadow: 0 0 0 rgba(59, 130, 246, 0.0);
        opacity: 0.8;
      }
    }

    .gx-tagline-glow {
      animation: gx-tagline-glow 2.8s ease-in-out infinite;
    }
  </style>
  </head>
<body>
<div class="w-full max-w-[480px] mx-auto min-h-screen flex flex-col bg-background-light dark:bg-background-dark font-display">
<header class="flex shrink-0 items-center bg-background-light dark:bg-background-dark p-4 pb-2 justify-between sticky top-0 z-10">
  <div class="flex size-12 shrink-0 items-center justify-start">
    <span class="material-symbols-outlined text-zinc-800 dark:text-white" style="font-size: 28px;">
      auto_awesome
    </span>
  </div>
  <div class="flex flex-col items-center flex-1 min-w-0">
    <h1 class="text-zinc-800 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">
      Actify
    </h1>
    <p class="text-xs text-zinc-400 dark:text-zinc-300 mt-0.5 gx-tagline-glow">
      Search · Summarize · Act
    </p>
  </div>
  <div class="flex w-12 items-center justify-end">
    <button
      id="browse-reels-button"
      type="button"
      class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-9 w-9 bg-zinc-900/5 dark:bg-zinc-700 text-zinc-800 dark:text-white text-[11px] font-semibold leading-normal tracking-[0.02em] border border-zinc-300/70 dark:border-zinc-600"
    >
      <span class="material-symbols-outlined text-[16px]">
        video_library
      </span>
    </button>
  </div>
</header>
<main class="flex flex-col flex-1 px-4 py-3">
<div class="flex flex-col pt-4">
  <label class="flex flex-col w-full max-w-[480px] mx-auto gx-search-glow">
    <p class="text-zinc-800 dark:text-white text-base font-medium leading-normal pb-2 sr-only">Search Reels</p>
    <div class="relative">
        <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-zinc-400 dark:text-zinc-500" style="font-size: 24px;">
            search
        </span>
        <input id="search-input" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-zinc-800 dark:text-white focus:outline-0 focus:ring-0 border border-zinc-300 dark:border-zinc-700 bg-background-light dark:bg-zinc-800 focus:border-primary h-16 placeholder:text-zinc-400 dark:placeholder:text-zinc-500 pl-[52px] pr-[15px] text-lg font-normal leading-normal" placeholder="Describe a reel..." value=""/>
        <button id="search-btn" class="absolute right-3 top-1/2 -translate-y-1/2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-600 transition-colors">
            Search
        </button>
    </div>
</label>
<!-- Reel suggestions / recent reels grid -->
<div class="w-full max-w-[480px] mt-4 mx-auto">
  <div class="flex items-center justify-between mb-2">
    <p class="text-[11px] font-medium text-zinc-500 dark:text-zinc-400 tracking-[0.04em] uppercase">
      Recently saved reels
    </p>
    <button
      id="recent-refresh-btn"
      type="button"
      class="inline-flex items-center gap-1 rounded-full border border-zinc-300/70 dark:border-zinc-600 px-3 py-1 text-[11px] font-semibold text-zinc-700 dark:text-zinc-200 bg-zinc-100/60 dark:bg-zinc-800/60 hover:bg-zinc-200/80 dark:hover:bg-zinc-700/80 transition"
    >
      <span class="material-symbols-outlined text-[14px]">
        refresh
      </span>
      <span>Refresh</span>
    </button>
  </div>
  <div id="reel-suggestions">
    <!-- Cards will be populated here -->
  </div>
</div>

</div>
<div class="flex flex-col gap-4 mt-8 px-4 w-full max-w-[480px] mx-auto">
<div class="flex flex-col gap-2">
<label class="text-zinc-800 dark:text-white text-base font-medium leading-normal" for="reel-link-input">Paste Instagram Reel Link</label>
<div class="relative">
<span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 dark:text-zinc-500" style="font-size: 20px;">
                            link
                        </span>
<input class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-zinc-800 dark:text-white focus:outline-0 focus:ring-0 border border-zinc-300 dark:border-zinc-700 bg-background-light dark:bg-zinc-800 focus:border-primary h-12 placeholder:text-zinc-400 dark:placeholder:text-zinc-500 pl-10 pr-4 text-base font-normal leading-normal" id="reel-link-input" placeholder="https://www.instagram.com/reel/..."/>
</div>
</div>
<button id="process-reel-btn" class="flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 bg-primary text-white gap-2 text-base font-bold leading-normal tracking-[0.015em] min-w-0 px-4">
<span class="material-symbols-outlined" style="font-size: 20px;">
                        bolt
                    </span>
<span>Process Instagram Reel</span>
</button>
</div>
</main>
<footer class="sticky bottom-0 bg-background-light dark:bg-background-dark px-4 py-4 border-t border-zinc-200 dark:border-zinc-800 flex flex-col items-center justify-center mt-auto">
<p class="text-zinc-600 dark:text-zinc-300 text-sm font-medium leading-normal">Powered by Supermemory.ai</p>
</footer>
</div>

<script>
  // Simple client-side handler to submit the reel URL to the FastAPI backend
  // and navigate to the processing status screen.
   /*async function submitReel() {
    const input = document.getElementById('reel-link-input');
    if (!input) return;

    const instagramUrl = input.value.trim();
    if (!instagramUrl) {
      alert('Please paste an Instagram reel URL.');
      return;
    }

    try {
      const resp = await fetch('/api/reels/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ instagram_url: instagramUrl }),
      });

      if (!resp.ok) {
        const err = await resp.json().catch(() => ({}));
        throw new Error(err.detail || 'Failed to submit reel');
      }

      const data = await resp.json();
      const taskId = data.task_id;

      // Navigate to the processing status UI (served by FastAPI), passing the task id
      window.location.href = `/processing-status?task_id=${encodeURIComponent(taskId)}`;
    } catch (e) {
      console.error(e);
      alert('Error submitting reel: ' + e.message);
    }
  }

 window.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('process-reel-btn');
    if (!btn) return;
    btn.addEventListener('click', submitReel);
  });*/

  function renderReelCards(results) {
    const container = document.getElementById('reel-suggestions');
    if (!container) return;

    container.innerHTML = '';

    if (!results || !results.length) {
      container.innerHTML = `
        <div class="flex items-center justify-center p-8">
          <p class="text-zinc-500 dark:text-zinc-400">No reels found</p>
        </div>
      `;
      return;
    }

    const grid = document.createElement('div');
    grid.className = 'grid grid-cols-2 gap-4';

    results.forEach((result) => {
      const thumbnailUrl = result.thumbnail_url || '';
      const title = escapeHtml(result.title || 'Untitled');
      const documentId = result.document_id || result.reel_id;

      const card = document.createElement('button');
      card.type = 'button';
      card.className =
        'relative overflow-hidden rounded-3xl bg-zinc-900/60 focus:outline-none focus:ring-2 focus:ring-primary/70 text-left';

      // Build card content with a local fallback when no thumbnail is available.
      const hasThumb = Boolean(thumbnailUrl);
      const imageSection = hasThumb
        ? `
        <div class="aspect-[3/4] w-full overflow-hidden">
          <img
            src="${thumbnailUrl}"
            alt="${title}"
            class="h-full w-full object-cover"
          />
        </div>`
        : `
        <div class="aspect-[3/4] w-full overflow-hidden bg-gradient-to-br from-zinc-800 via-zinc-900 to-zinc-950 flex items-center justify-center">
          <span class="material-symbols-outlined text-zinc-500" style="font-size: 40px;">
            movie
          </span>
        </div>`;

      card.innerHTML = `
        ${imageSection}
        <div class="pointer-events-none absolute inset-x-0 bottom-0 p-4 bg-gradient-to-t from-black/80 via-black/40 to-transparent">
          <p class="text-white text-sm font-semibold line-clamp-2">${title}</p>
        </div>
      `;

      if (documentId) {
        card.addEventListener('click', () => {
          window.location.href = `/generic-view?document_id=${encodeURIComponent(documentId)}`;
        });
      }

      grid.appendChild(card);
    });

    container.appendChild(grid);
  }

  async function performSearch() {
    const input = document.getElementById('search-input');
    const suggestionsContainer = document.getElementById('reel-suggestions');
    
    if (!input || !suggestionsContainer) return;
    
    const query = input.value.trim();
    if (!query) {
      alert('Please enter a search query.');
      return;
    }
    
    // Show loading state
    suggestionsContainer.innerHTML = `
      <div class="flex items-center justify-center p-8">
        <p class="text-zinc-500 dark:text-zinc-400">Searching...</p>
      </div>
    `;
    
    try {
      const resp = await fetch('/api/reels/search', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query: query, limit: 10 }),
      });
      
      if (!resp.ok) {
        const err = await resp.json().catch(() => ({}));
        throw new Error(err.detail || 'Search failed');
      }
      
      const data = await resp.json();
      renderReelCards(data.results || []);
      
    } catch (e) {
      console.error(e);
      suggestionsContainer.innerHTML = `
        <div class="flex items-center justify-center p-8">
          <p class="text-red-500">Error: ${escapeHtml(e.message)}</p>
        </div>
      `;
    }
  }

  function getCachedRecentReels() {
    try {
      const raw = localStorage.getItem('gx_recent_reels');
      if (!raw) return null;
      const parsed = JSON.parse(raw);
      if (!parsed || !Array.isArray(parsed.results)) return null;
      return parsed;
    } catch (e) {
      console.warn('Failed to read recent reels cache', e);
      return null;
    }
  }

  async function loadRecentReels(force = false) {
    const suggestionsContainer = document.getElementById('reel-suggestions');
    if (!suggestionsContainer) return;

    // If not forcing a refresh, try to use cached recent reels first.
    if (!force) {
      const cached = getCachedRecentReels();
      if (cached && cached.results && cached.results.length) {
        renderReelCards(cached.results);
        return;
      }
    }

    suggestionsContainer.innerHTML = `
      <div class="flex items-center justify-center p-8">
        <p class="text-zinc-500 dark:text-zinc-400">Loading recent reels...</p>
      </div>
    `;

    try {
      const resp = await fetch('/api/reels/recent?limit=8');
      if (!resp.ok) {
        const err = await resp.json().catch(() => ({}));
        throw new Error(err.detail || 'Failed to load recent reels');
      }
      const data = await resp.json();
      const results = data.results || [];
      renderReelCards(results);

      // Persist the latest recent reels so we do not have to refetch on every load.
      try {
        localStorage.setItem('gx_recent_reels', JSON.stringify({ results }));
      } catch (e) {
        console.warn('Failed to cache recent reels', e);
      }
    } catch (e) {
      console.error(e);
      suggestionsContainer.innerHTML = `
        <div class="flex items-center justify-center p-8">
          <p class="text-red-500">Error loading recent reels: ${escapeHtml(e.message)}</p>
        </div>
      `;
    }
  }

  // Helper function to escape HTML
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // Submit reel functionality (existing)
  async function submitReel() {
    const input = document.getElementById('reel-link-input');
    if (!input) return;

    const instagramUrl = input.value.trim();
    if (!instagramUrl) {
      alert('Please paste an Instagram reel URL.');
      return;
    }

    try {
      const resp = await fetch('/api/reels/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ instagram_url: instagramUrl }),
      });

      if (!resp.ok) {
        const err = await resp.json().catch(() => ({}));
        throw new Error(err.detail || 'Failed to submit reel');
      }

      const data = await resp.json();
      const taskId = data.task_id;

      window.location.href = `/processing-status?task_id=${encodeURIComponent(taskId)}`;
    } catch (e) {
      console.error(e);
      alert('Error submitting reel: ' + e.message);
    }
  }

  // Event listeners
  window.addEventListener('DOMContentLoaded', () => {
    const searchBtn = document.getElementById('search-btn');
    const searchInput = document.getElementById('search-input');
    const processBtn = document.getElementById('process-reel-btn');
    const browseBtn = document.getElementById('browse-reels-button');
    const recentRefreshBtn = document.getElementById('recent-refresh-btn');
    
    if (searchBtn) {
      searchBtn.addEventListener('click', performSearch);
    }
    
    if (searchInput) {
      // Allow Enter key to trigger search
      searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          performSearch();
        }
      });
    }
    
    if (processBtn) {
      processBtn.addEventListener('click', submitReel);
    }

    if (browseBtn) {
      browseBtn.addEventListener('click', () => {
        window.location.href = '/browse-reels';
      });
    }

    if (recentRefreshBtn) {
      recentRefreshBtn.addEventListener('click', () => {
        loadRecentReels(true);
      });
    }

    // On first load, show the most recent reels saved in Supermemory.
    loadRecentReels(false);
  });
</script>

</body></html>